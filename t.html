<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>AMC Finder • Fund Name / ISIN → AMC, Logo & Colors</title>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<style>
  :root{ --bg:#0f1115; --card:#151922; --ink:#e8eef6; --muted:#95a3b8; --line:#222734; }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font:15px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;padding:28px}
  h1{margin:0 0 10px;font-size:20px}
  .sub{color:var(--muted);margin-bottom:18px}
  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center;margin-bottom:16px}
  .input{display:flex;align-items:center;gap:10px;padding:12px 14px;border:1px solid var(--line);border-radius:12px;background:#0d1016;min-width:280px;flex:1}
  .input input{border:none;outline:none;background:transparent;color:var(--ink);width:100%}
  .btn{appearance:none;border:1px solid var(--line);background:#111726;color:var(--ink);padding:10px 14px;border-radius:12px;cursor:pointer}
  .btn:disabled{opacity:.5;cursor:not-allowed}
  .hint{color:var(--muted);font-size:12px}
  .nohit{margin-top:10px;padding:12px;border:1px dashed #394055;border-radius:10px;background:#0d1318;color:#b2c7d7}
  h2{margin:26px 0 10px;font-size:18px}

  /* tabs */
  .tabs{display:flex;gap:8px;margin:10px 0 16px}
  .tab{flex:1;display:inline-flex;justify-content:center;align-items:center;padding:10px 12px;border:1px solid var(--line);border-radius:999px;background:#0d1016;color:var(--ink);cursor:pointer;user-select:none}
  .tab.active{background:#162033;border-color:#31405a;font-weight:600}

  /* card */
  .card{margin-top:12px;background:var(--card);border:1px solid var(--line);border-radius:16px;overflow:hidden;display:none}
  .card.show{display:block}
  .top{padding:14px;border-bottom:1px solid var(--line)}
  .topgrid{display:grid;grid-template-columns:auto 1fr;gap:12px;align-items:center;margin-bottom:12px}
  .logo{width:60px;height:60px;border-radius:12px;background:#fff;border:1px solid #e9eef3;display:grid;place-items:center;overflow:hidden}
  .logo img{max-width:90%;max-height:90%;object-fit:contain}
  .title{font-weight:600}
  .muted{color:var(--muted);font-size:12px}
  .grad{height:24px;border-radius:8px;border:1px solid var(--line)}
  .kv{display:grid;grid-template-columns:110px 1fr;gap:6px 10px;padding:12px;border-bottom:1px solid var(--line)}
  .kv .k{color:var(--muted)}
  .kv .v code{background:#0d1016;border:1px solid var(--line);padding:2px 6px;border-radius:6px}
  .sw{display:grid;grid-template-columns:1fr 1fr;gap:12px;padding:14px}
  .box{border:1px solid var(--line);border-radius:12px;overflow:hidden}
  .chip{height:46px;display:flex;align-items:center;justify-content:center;font-weight:600;font-size:13px}
  .code{padding:8px 10px;border-top:1px solid var(--line);display:flex;justify-content:space-between;align-items:center}
  .pill{font-size:11px;padding:2px 8px;border-radius:999px;background:#0d131b;border:1px solid var(--line);color:#95a3b8}
  .copy{border:1px solid var(--line);background:#111726;color:var(--ink);border-radius:8px;padding:4px 8px;cursor:pointer;font-size:12px}

  /* grid */
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px;margin-top:6px}
  .card-mini{background:var(--card);border:1px solid var(--line);border-radius:14px;overflow:hidden}
  .card-mini .mini-top{padding:12px;border-bottom:1px solid var(--line)}
  .card-mini .logo-title{display:flex;gap:12px;align-items:center;margin-bottom:10px}
  .card-mini .logo-wrap{width:50px;height:50px;border-radius:12px;overflow:hidden;background:#fff;display:grid;place-items:center;border:1px solid #e9eef3}
  .card-mini .logo-wrap img{max-width:90%;max-height:90%;object-fit:contain}
  .card-mini .gradient-bar{height:20px;border-radius:6px;border:1px solid var(--line)}
  .card-mini .swatches{display:grid;grid-template-columns:1fr 1fr;gap:10px;padding:12px}

  /* Add-your-own section */
  .uploader{margin-top:24px;padding:16px;border:1px dashed var(--line);border-radius:14px;background:#0d1016}
  .two{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  @media (max-width:640px){ .two{grid-template-columns:1fr} }
  .stack{display:grid;gap:8px}
  .tiny{font-size:11px;color:#8ea0b6}
  .inputs-inline{display:flex;gap:8px;flex-wrap:wrap}
  .hexinput{background:#0d1016;border:1px solid var(--line);border-radius:10px;padding:8px 10px;color:var(--ink);width:140px}
  .thumb{width:48px;height:48px;border-radius:10px;background:#fff;border:1px solid #e9eef3;display:grid;place-items:center;overflow:hidden}
  .added{margin-top:10px;padding:10px;border:1px dashed #394055;border-radius:10px;background:#0d1216}
</style>
</head>
<body>
  <h1>AMC Finder</h1>
  <div class="sub">Toggle the mode: <strong>Fund Name</strong> or <strong>ISIN</strong>. We’ll detect the AMC and show its Logo & Brand Colors.</div>

  <!-- Segmented control -->
  <div class="tabs" role="tablist" aria-label="Lookup mode">
    <button id="tab-name" class="tab active" role="tab" aria-selected="true" aria-controls="panel-name">Lookup by Fund Name</button>
    <button id="tab-isin" class="tab" role="tab" aria-selected="false" aria-controls="panel-isin">Lookup by ISIN</button>
  </div>

  <!-- Panel: Fund Name -->
  <section id="panel-name" role="tabpanel" aria-labelledby="tab-name">
    <div class="row">
      <label class="input" title="Type a fund name">
        <input id="fund" placeholder="Tata xyzzy fund, HDFC Index, Aditya Birla Gold…" autofocus/>
      </label>
      <button class="btn" id="go-name">Find AMC</button>
    </div>
  </section>

  <!-- Panel: ISIN -->
  <section id="panel-isin" role="tabpanel" aria-labelledby="tab-isin" hidden>
    <div class="row">
      <label class="input" title="Enter an ISIN">
        <input id="isin" placeholder="e.g., INF189A01046" autocapitalize="characters"/>
      </label>
      <button class="btn" id="go-isin">Lookup</button>
      <button class="btn" id="demo">Load Demo ISINs</button>
    </div>
    <div class="hint">Tip: place a <code>data.json</code> next to this file with entries like:
      <code>[{"isin":"INF189A01046","fundName":"UTI Top 100 Fund"}, ...]</code>
    </div>
  </section>

  <div id="msg" class="nohit" style="display:none" role="status" aria-live="polite"></div>

  <!-- Shared result card -->
  <section id="card" class="card" aria-live="polite">
    <div class="top">
      <div class="topgrid">
        <div class="logo"><img id="logo" alt="AMC logo"/></div>
        <div>
          <div class="title" id="amc-name">—</div>
          <div class="muted" id="host">—</div>
        </div>
      </div>
      <div id="grad" class="grad"></div>
    </div>

    <div class="kv" id="kv">
      <div class="k">Fund Name</div><div class="v" id="fund-name">—</div>
      <div class="k">ISIN</div><div class="v"><code id="fund-isin">—</code></div>
    </div>

    <div class="sw">
      <div class="box">
        <div id="pchip" class="chip">—</div>
        <div class="code"><span class="pill">Primary</span><button id="pcopy" class="copy" disabled>Copy</button></div>
      </div>
      <div class="box">
        <div id="schip" class="chip">—</div>
        <div class="code"><span class="pill">Secondary</span><button id="scopy" class="copy" disabled>Copy</button></div>
      </div>
    </div>
  </section>

  <h2>All AMCs</h2>
  <div id="grid" class="grid"></div>

  <!-- ==== Add your own AMC (LAST SECTION) ==== -->
  <h2>Add your own AMC</h2>
  <div class="uploader">
    <div class="two">
      <div class="stack">
        <span class="tiny">AMC / Bank Name</span>
        <label class="input"><input id="u-name" placeholder="e.g., Perccent Asset Management"/></label>
      </div>
      <div class="stack">
        <span class="tiny">Logo URL (optional if uploading)</span>
        <label class="input"><input id="u-url" placeholder="https://example.com/logo.png"/></label>
      </div>
    </div>

    <div class="two" style="margin-top:10px">
      <div class="stack">
        <span class="tiny">Upload Logo Image</span>
        <div class="inputs-inline">
          <input type="file" id="u-file" accept="image/*" class="btn" />
          <button class="btn" id="u-detect">Detect colors</button>
        </div>
        <div class="inputs-inline" style="margin-top:8px;align-items:center">
          <div class="thumb"><img id="u-thumb" alt="preview" style="max-width:90%;max-height:90%;object-fit:contain;display:none"/></div>
          <span class="tiny" id="u-src">No image yet</span>
        </div>
      </div>
      <div class="stack">
        <span class="tiny">Primary & 20% darker (editable)</span>
        <div class="inputs-inline">
          <input class="hexinput" id="u-primary" placeholder="#RRGGBB"/>
          <input class="hexinput" id="u-secondary" placeholder="#RRGGBB"/>
          <button class="btn" id="u-add" disabled>Add to list</button>
        </div>
        <span class="tiny">Tip: You can tweak hexes before adding.</span>
      </div>
    </div>

    <div id="added" class="added" style="display:none"></div>
  </div>

<script>
/* ===========================
   Seed Data (colors & logos)
   =========================== */
const COLORS = [
  {"name":"360 ONE","primaryHex":"#05030f","secondaryHex":"#04020c"},
  {"name":"Aditya Birla Sun Life","primaryHex":"#d44945","secondaryHex":"#b72e2a"},
  {"name":"Angel","primaryHex":"#edefe7","secondaryHex":"#c3c9af"},
  {"name":"Axis","primaryHex":"#a53465","secondaryHex":"#842a51"},
  {"name":"Bajaj Finserv","primaryHex":"#327cbc","secondaryHex":"#286396"},
  {"name":"Bandhan","primaryHex":"#f1bdb0","secondaryHex":"#e48269"},
  {"name":"BNP Paribas","primaryHex":"#d9d8cc","secondaryHex":"#b5b39c"},
  {"name":"BOI AXA","primaryHex":"#254380","secondaryHex":"#1e3666"},
  {"name":"Canara Robeco","primaryHex":"#19a3bd","secondaryHex":"#148297"},
  {"name":"Capitalmind","primaryHex":"#ebe9ee","secondaryHex":"#bbb4c5"},
  {"name":"DSP","primaryHex":"#264a68","secondaryHex":"#1e3b53"},
  {"name":"Edelweiss","primaryHex":"#1e60b0","secondaryHex":"#184d8d"},
  {"name":"Franklin Templeton","primaryHex":"#4f7a99","secondaryHex":"#3f627a"},
  {"name":"Groww","primaryHex":"#bee0ec","secondaryHex":"#7cc1d9"},
  {"name":"HDFC","primaryHex":"#c32323","secondaryHex":"#9c1c1c"},
  {"name":"Helios","primaryHex":"#1c1208","secondaryHex":"#160e06"},
  {"name":"HSBC","primaryHex":"#df1d2c","secondaryHex":"#b21723"},
  {"name":"ICICI","primaryHex":"#ca5338","secondaryHex":"#a3422b"},
  {"name":"Invesco","primaryHex":"#345097","secondaryHex":"#2a4079"},
  {"name":"ITI","primaryHex":"#e05c47","secondaryHex":"#ca3922"},
  {"name":"Jio BlackRock","primaryHex":null,"secondaryHex":null},
  {"name":"JM Financial","primaryHex":"#30377f","secondaryHex":"#262c66"},
  {"name":"Kotak","primaryHex":"#ba3753","secondaryHex":"#952c42"},
  {"name":"LIC","primaryHex":"#3c66ab","secondaryHex":"#305289"},
  {"name":"Mahindra","primaryHex":"#f5f0f0","secondaryHex":"#ceb6b6"},
  {"name":"Mirae","primaryHex":"#1e5681","secondaryHex":"#184567"},
  {"name":"Motilal Oswal","primaryHex":"#fcc543","secondaryHex":"#fbb204"},
  {"name":"NAVI","primaryHex":"#37265a","secondaryHex":"#2c1e48"},
  {"name":"Nippon","primaryHex":"#fed9d5","secondaryHex":"#fc867a"},
  {"name":"Nj","primaryHex":"#bb6064","secondaryHex":"#9f4448"},
  {"name":"Old Bridge","primaryHex":"#7a7a7b","secondaryHex":"#626262"},
  {"name":"PGIM","primaryHex":"#c3cad1","secondaryHex":"#95a2ae"},
  {"name":"PPFAS","primaryHex":"#dee2d7","secondaryHex":"#b4bda4"},
  {"name":"Quant","primaryHex":"#111212","secondaryHex":"#0e0e0e"},
  {"name":"Quantum","primaryHex":"#b6cce5","secondaryHex":"#79a2cf"},
  {"name":"Samco","primaryHex":"#f4eff1","secondaryHex":"#cdb6bf"},
  {"name":"SBI","primaryHex":"#2ba7e0","secondaryHex":"#1b88ba"},
  {"name":"Shriram","primaryHex":"#787774","secondaryHex":"#605f5d"},
  {"name":"Sundaram","primaryHex":"#3576b0","secondaryHex":"#2a5e8d"},
  {"name":"Tata","primaryHex":"#3576b0","secondaryHex":"#2a5e8d"},
  {"name":"Taurus","primaryHex":"#64302f","secondaryHex":"#502626"},
  {"name":"Trust","primaryHex":"#f7f6f3","secondaryHex":"#d0cab8"},
  {"name":"unifi","primaryHex":"#080403","secondaryHex":"#060302"},
  {"name":"Union","primaryHex":"#1f4665","secondaryHex":"#193851"},
  {"name":"UTI","primaryHex":"#cc7431","secondaryHex":"#a35d27"},
  {"name":"WhiteOak","primaryHex":"#465d6c","secondaryHex":"#384a56"},
  {"name":"Zerodha","primaryHex":"#565656","secondaryHex":"#454545"}
];

const LOGOS = [
  {"name":"360 ONE","logo":"https://indcdn.indmoney.com/cdn-cgi/image/quality=90,format=auto,width=82.5/https://indcdn.indmoney.com//360_one_amc.png"},
  {"name":"Aditya Birla Sun Life","logo":"https://indcdn.indmoney.com/public/images/amc_aditya_birla.png"},
  {"name":"Angel","logo":"https://indcdn.indmoney.com/images/fe/angeloneamclogo.png"},
  {"name":"Axis","logo":"https://indcdn.indmoney.com/public/images/amc_axis.png"},
  {"name":"Bajaj Finserv","logo":"https://indcdn.indmoney.com/public/images/mf-bajaj-finserv-amc-logo-small.png"},
  {"name":"Bandhan","logo":"https://indcdn.indmoney.com/public/images/amc_bandhan.png"},
  {"name":"BNP Paribas","logo":"https://indcdn.indmoney.com/public/images/amc_bnp_paribas_bb.jpg"},
  {"name":"BOI AXA","logo":"https://indcdn.indmoney.com/public/images/amc_boi_axa.png"},
  {"name":"Canara Robeco","logo":"https://indcdn.indmoney.com/public/images/amc_canara.png"},
  {"name":"Capitalmind","logo":"https://indcdn.indmoney.com/cdn-cgi/image/quality=90,format=auto,width=82.5/https://indcdn.indmoney.com//capitalmindmf_logo.jpg"},
  {"name":"DSP","logo":"https://indcdn.indmoney.com/public/images/amc_dsp.png"},
  {"name":"Edelweiss","logo":"https://indcdn.indmoney.com/public/images/amc_edelweiss.png"},
  {"name":"Franklin Templeton","logo":"https://indcdn.indmoney.com/public/images/amc_franklin.png"},
  {"name":"Groww","logo":"https://indcdn.indmoney.com/public/images/amc_groww.png"},
  {"name":"HDFC","logo":"https://indcdn.indmoney.com/public/images/amc_hdfc.png"},
  {"name":"Helios","logo":"https://indcdn.indmoney.com/cdn-cgi/image/quality=90,format=auto,width=82.5/https://indcdn.indmoney.com//helios-mutual-fund-amc.png"},
  {"name":"HSBC","logo":"https://indcdn.indmoney.com/public/images/amc_hsbc.png"},
  {"name":"ICICI","logo":"https://indcdn.indmoney.com/public/images/amc_icici.png"},
  {"name":"Invesco","logo":"https://indcdn.indmoney.com/public/images/amc_invesco.png"},
  {"name":"ITI","logo":"https://indcdn.indmoney.com/public/images/amc_iti.png"},
  {"name":"Jio BlackRock","logo":"https://indcdn.indmoney.com/cdn-cgi/image/quality=90,format=auto,width=82.5/https://indcdn.indmoney.com//jio_blackrock_amc.png"},
  {"name":"JM Financial","logo":"https://indcdn.indmoney.com/public/images/amc_jm.png"},
  {"name":"Kotak","logo":"https://indcdn.indmoney.com/public/images/amc_kotak.png"},
  {"name":"LIC","logo":"https://indcdn.indmoney.com/public/images/amc_lic.png"},
  {"name":"Mahindra","logo":"https://indcdn.indmoney.com/public/images/mahindra-manulife-amc-thumbnail-logo.png"},
  {"name":"Mirae","logo":"https://indcdn.indmoney.com/public/images/amc_mirae.png"},
  {"name":"Motilal Oswal","logo":"https://indcdn.indmoney.com/public/images/amc_motilal.png"},
  {"name":"NAVI","logo":"https://indcdn.indmoney.com/public/images/navi-amc-thumbnail-logo.png"},
  {"name":"Nippon","logo":"https://indcdn.indmoney.com/public/images/amc_nippon.png"},
  {"name":"Nj","logo":"https://indcdn.indmoney.com/public/images/amc_nj_asset.png"},
  {"name":"Old Bridge","logo":"https://indcdn.indmoney.com/images/fe/old-bridge-mutual-fund.png"},
  {"name":"PGIM","logo":"https://indcdn.indmoney.com/public/images/amc_pgim.png"},
  {"name":"PPFAS","logo":"https://indcdn.indmoney.com/public/images/amc_parag.png"},
  {"name":"Quant","logo":"https://indcdn.indmoney.com/public/images/amc_quant.png"},
  {"name":"Quantum","logo":"https://indcdn.indmoney.com/public/images/amc_quantum.png"},
  {"name":"Samco","logo":"https://indcdn.indmoney.com/public/images/amc_samco.png"},
  {"name":"SBI","logo":"https://indcdn.indmoney.com/public/images/amc_sbi.png"},
  {"name":"Shriram","logo":"https://indcdn.indmoney.com/public/images/amc_shriram.png"},
  {"name":"Sundaram","logo":"https://indcdn.indmoney.com/public/images/amc_sundaram.png"},
  {"name":"Tata","logo":"https://indcdn.indmoney.com/cdn-cgi/image/quality=90,format=auto,width=82.5/https://indcdn.indmoney.com//amc_tata_new.jpg"},
  {"name":"Taurus","logo":"https://indcdn.indmoney.com/public/images/amc_taurus.png"},
  {"name":"Trust","logo":"https://indcdn.indmoney.com/public/images/amc_trust_asset.png"},
  {"name":"unifi","logo":"https://indcdn.indmoney.com/public/images/unifi_amc_logo.png"},
  {"name":"Union","logo":"https://indcdn.indmoney.com/public/images/amc_union.png"},
  {"name":"UTI","logo":"https://indcdn.indmoney.com/public/images/amc_uti.png"},
  {"name":"WhiteOak","logo":"https://indcdn.indmoney.com/public/images/amc_whiteoakamc.png"},
  {"name":"Zerodha","logo":"https://indcdn.indmoney.com/public/images/mf_zerodha.png"}
];

/* Alias map */
const ALIASES = {
  "Aditya Birla Sun Life": ["aditya birla","birla","absl","aditya birla sun life"],
  "Axis": ["axis"],
  "Bajaj Finserv": ["bajaj","bajaj finserv"],
  "Bandhan": ["bandhan"],
  "BNP Paribas": ["bnp","bnpp","paribas","bnp paribas"],
  "BOI AXA": ["boi axa","boiaxa","boi"],
  "Canara Robeco": ["canara","robeco","canara robeco"],
  "Capitalmind": ["capitalmind"],
  "DSP": ["dsp"],
  "Edelweiss": ["edelweiss"],
  "Franklin Templeton": ["franklin","templeton","franklin templeton","ft"],
  "Groww": ["groww"],
  "HDFC": ["hdfc"],
  "Helios": ["helios"],
  "HSBC": ["hsbc"],
  "ICICI": ["icici","icici prudential","icici pru"],
  "Invesco": ["invesco"],
  "ITI": ["iti"],
  "Jio BlackRock": ["jio","blackrock","jio blackrock"],
  "JM Financial": ["jm","jm financial"],
  "Kotak": ["kotak"],
  "LIC": ["lic","life insurance corporation"],
  "Mahindra": ["mahindra","mahindra manulife","manulife"],
  "Mirae": ["mirae","mirae asset"],
  "Motilal Oswal": ["motilal","motilal oswal","mo"],
  "NAVI": ["navi"],
  "Nippon": ["nippon","reliance"],
  "Nj": ["nj"],
  "Old Bridge": ["old bridge"],
  "PGIM": ["pgim","prudential"],
  "PPFAS": ["ppfas","parag parikh","parag"],
  "Quant": ["quant"],
  "Quantum": ["quantum"],
  "Samco": ["samco"],
  "SBI": ["sbi","state bank"],
  "Shriram": ["shriram"],
  "Sundaram": ["sundaram"],
  "Tata": ["tata"],
  "Taurus": ["taurus"],
  "Trust": ["trust","trust mf","trust mutual"],
  "unifi": ["unifi","unifi capital"],
  "Union": ["union","union mf"],
  "UTI": ["uti","unit trust"],
  "WhiteOak": ["whiteoak","white oak"],
  "Zerodha": ["zerodha"],
  "360 ONE": ["360 one","iox","360one"]
};

const logoBy = new Map(LOGOS.map(x=>[x.name,x.logo]));
const colorBy = new Map(COLORS.map(x=>[x.name,{p:x.primaryHex,s:x.secondaryHex}]));

/* ===========================
   Utilities
   =========================== */
const $ = id=>document.getElementById(id);
const cardEl=$('card'), msgEl=$('msg');
const amcNameEl=$('amc-name'), hostEl=$('host'), logoEl=$('logo'), gradEl=$('grad');
const fundNameEl=$('fund-name'), fundIsinEl=$('fund-isin');
const pchip=$('pchip'), schip=$('schip'), pcopy=$('pcopy'), scopy=$('scopy');
const kvEl = $('kv');

function textOn(hex){
  if(!hex) return '#fff';
  const m=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
  if(!m) return '#fff';
  const [r,g,b]=[m[1],m[2],m[3]].map(h=>parseInt(h,16)/255);
  const L=0.2126*r+0.7152*g+0.0722*b;
  return L>0.4?'#0a0e14':'#fff';
}
function showMsg(t){ msgEl.textContent=t; msgEl.style.display='block'; cardEl.classList.remove('show'); }
function clearMsg(){ msgEl.style.display='none'; msgEl.textContent=''; }

/* Render selected AMC */
function renderAMC(name, opts={}){
  const logo=logoBy.get(name)||'';
  const cs=colorBy.get(name)||{};
  const p=cs.p||null, s=cs.s||null;

  amcNameEl.textContent=name||'—';
  if(logo){
    try{ hostEl.textContent=new URL(logo).hostname; }catch{ hostEl.textContent='Logo'; }
  }else{
    hostEl.textContent='No logo';
  }
  logoEl.src=logo||'';
  gradEl.style.background=(p&&s)?`linear-gradient(to right,${p},${s})`:'#222';

  pchip.textContent=p||'—'; pchip.style.background=p||'transparent'; pchip.style.color=textOn(p);
  schip.textContent=s||'—'; schip.style.background=s||'transparent'; schip.style.color=textOn(s);

  pcopy.disabled=!p; scopy.disabled=!s;
  pcopy.onclick=()=>p && navigator.clipboard.writeText(p);
  scopy.onclick=()=>s && navigator.clipboard.writeText(s);

  // optional metadata rows (fund+isin) if provided
  if(opts.kv === false){ kvEl.style.display='none'; }
  else{
    kvEl.style.display='grid';
    fundNameEl.textContent = opts.fundName || '—';
    fundIsinEl.textContent = opts.isin || '—';
  }

  clearMsg();
  cardEl.classList.add('show');
}

/* Name detection from free text fund name */
function detectAMCFromText(text){
  const q = (text||'').toLowerCase();

  // special handling: Quantum vs Quant
  if(/\bquantum\b/.test(q)) return 'Quantum';
  if(/\bquant\b/.test(q)) return 'Quant';

  // alias hits
  for(const [name, list] of Object.entries(ALIASES)){
    for(const a of list){ if(q.includes(a.toLowerCase())) return name; }
  }
  // fallback: include brand name literal
  for(const name of colorBy.keys()){
    if(q.includes(name.toLowerCase())) return name;
  }
  return null;
}

/* ===========================
   Fund Name mode
   =========================== */
$('go-name').onclick=()=>{
  const q=$('fund').value.trim();
  if(!q){ showMsg('Please enter a fund name.'); return; }
  const amc = detectAMCFromText(q);
  if(amc) renderAMC(amc, { fundName:q, kv:true, isin:'' });
  else showMsg('No AMC keyword found in the fund name.');
};

/* ===========================
   ISIN mode
   =========================== */
/* Embedded demo dataset (fallback) */
const DATA_DEMO = [
  { isin:"INF189A01046", fundName:"UTI Top 100 Fund" },
  { isin:"INF109K01ZV5", fundName:"HDFC Index Fund - Nifty 50 Plan" },
  { isin:"INF846K01AL2", fundName:"SBI Bluechip Fund" },
  { isin:"INF200K01303", fundName:"ICICI Prudential Bluechip Fund" },
  { isin:"INF179K01BB8", fundName:"Kotak Flexicap Fund" },
  { isin:"INF174K01DC2", fundName:"Franklin India Flexi Cap Fund" }
];

/* Try load data.json if available; otherwise use demo */
let ISIN_MAP = null;
async function ensureData(){
  if(ISIN_MAP) return;
  const map = new Map();
  try{
    const res = await fetch('./data.json',{cache:'no-store'});
    if(res.ok){
      const arr = await res.json();
      (arr||[]).forEach(x=>{
        if(x && x.isin && x.fundName){ map.set(String(x.isin).toUpperCase(), String(x.fundName)); }
      });
    }
  }catch{/* ignore */}
  if(map.size===0){
    DATA_DEMO.forEach(x=>map.set(x.isin.toUpperCase(), x.fundName));
  }
  ISIN_MAP = map;
}

$('go-isin').onclick = async ()=>{
  const raw = $('isin').value.trim();
  if(!raw){ showMsg('Please enter an ISIN.'); return; }
  const key = raw.toUpperCase();
  await ensureData();
  const fname = ISIN_MAP.get(key);
  if(!fname){ showMsg('ISIN not found in dataset. Add it to data.json or use the demo button.'); return; }
  const amc = detectAMCFromText(fname);
  if(amc) renderAMC(amc, { fundName: fname, isin: key, kv:true });
  else showMsg('Found the fund name, but could not detect its AMC keyword.');
};

$('demo').onclick = ()=>{
  $('isin').value = DATA_DEMO[0].isin;
  $('isin').focus();
};

/* ===========================
   Grid render (All AMCs)
   =========================== */
function renderGrid(){
  const grid=$('grid'); grid.innerHTML='';
  COLORS.forEach(item=>{
    const logo=logoBy.get(item.name)||'';
    const card=document.createElement('div');
    card.className='card-mini';
    card.innerHTML=`
      <div class="mini-top">
        <div class="logo-title">
          <div class="logo-wrap"><img src="${logo||''}" alt="${item.name} logo"/></div>
          <div><div class="title">${item.name}</div></div>
        </div>
        <div class="gradient-bar" style="background:${item.primaryHex&&item.secondaryHex?`linear-gradient(to right,${item.primaryHex},${item.secondaryHex})`:'#222'}"></div>
      </div>
      <div class="swatches">
        <div class="box">
          <div class="chip" style="background:${item.primaryHex||'transparent'};color:${textOn(item.primaryHex)}">${item.primaryHex||'—'}</div>
          <div class="code"><span class="pill">Primary</span><button class="copy" data-copy="${item.primaryHex||''}" ${item.primaryHex?'':'disabled'}>Copy</button></div>
        </div>
        <div class="box">
          <div class="chip" style="background:${item.secondaryHex||'transparent'};color:${textOn(item.secondaryHex)}">${item.secondaryHex||'—'}</div>
          <div class="code"><span class="pill">Secondary</span><button class="copy" data-copy="${item.secondaryHex||''}" ${item.secondaryHex?'':'disabled'}>Copy</button></div>
        </div>
      </div>`;
    card.querySelectorAll('button.copy').forEach(btn=>{
      btn.onclick=async ()=>{
        const v=btn.dataset.copy;if(!v) return;
        await navigator.clipboard.writeText(v);
        const old=btn.textContent; btn.textContent='Copied!'; setTimeout(()=>btn.textContent=old,800);
      };
    });
    grid.appendChild(card);
  });
}
renderGrid();

/* ===========================
   Add-your-own logic
   =========================== */
const upName = $('u-name');
const upUrl = $('u-url');
const upFile = $('u-file');
const upDetect = $('u-detect');
const upThumb = $('u-thumb');
const upSrc = $('u-src');
const upPrimary = $('u-primary');
const upSecondary = $('u-secondary');
const upAdd = $('u-add');
const addedBox = $('added');

let loadedImage = new Image();
let loadedSource = null;
loadedImage.crossOrigin = 'anonymous';

// helpers
function rgbToHex(r,g,b){
  const to2 = v => ('0'+Math.max(0,Math.min(255, v|0)).toString(16)).slice(-2);
  return '#'+to2(r)+to2(g)+to2(b);
}
function darken20(hex){
  const m = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex||'');
  if(!m) return '';
  const r = Math.floor(parseInt(m[1],16)*0.8);
  const g = Math.floor(parseInt(m[2],16)*0.8);
  const b = Math.floor(parseInt(m[3],16)*0.8);
  return rgbToHex(r,g,b);
}
function getAverageRGB(imgEl) {
  var blockSize = 5, defaultRGB = {r:0,g:0,b:0},
      canvas = document.createElement('canvas'),
      context = canvas.getContext && canvas.getContext('2d'),
      data, width, height, i = -4, length, rgb = {r:0,g:0,b:0}, count = 0;
  if (!context) { return defaultRGB; }
  height = canvas.height = imgEl.naturalHeight || imgEl.offsetHeight || imgEl.height;
  width = canvas.width = imgEl.naturalWidth || imgEl.offsetWidth || imgEl.width;
  context.drawImage(imgEl, 0, 0);
  try { data = context.getImageData(0, 0, width, height); }
  catch(e){ alert('Cannot read pixels from this image (CORS blocked). Try uploading the file instead.'); return defaultRGB; }
  length = data.data.length;
  while ( (i += blockSize * 4) < length ) { ++count; rgb.r += data.data[i]; rgb.g += data.data[i+1]; rgb.b += data.data[i+2]; }
  rgb.r = ~~(rgb.r/count); rgb.g = ~~(rgb.g/count); rgb.b = ~~(rgb.b/count);
  return rgb;
}
function loadForPreview(src){
  return new Promise((resolve,reject)=>{
    loadedImage.onload = ()=>{ 
      upThumb.style.display='block';
      upThumb.src = src;
      upSrc.textContent = src;
      loadedSource = src;
      resolve();
    };
    loadedImage.onerror = reject;
    loadedImage.src = src;
  });
}
upFile.addEventListener('change', async () => {
  const f = upFile.files && upFile.files[0];
  if(!f) return;
  const obj = URL.createObjectURL(f);
  try{ await loadForPreview(obj); }catch{ upSrc.textContent = 'Failed to load image.'; }
});
upUrl.addEventListener('change', async ()=>{
  const url = upUrl.value.trim(); if(!url) return;
  try{ await loadForPreview(url); }catch{ upSrc.textContent = 'Failed to load URL image. You can try uploading the file.'; }
});
upDetect.addEventListener('click', ()=>{
  if(!loadedImage || !loadedImage.complete){ alert('Please paste a Logo URL or upload a logo first.'); return; }
  const avg = getAverageRGB(loadedImage);
  const primary = rgbToHex(avg.r, avg.g, avg.b);
  const secondary = darken20(primary);
  upPrimary.value = primary;
  upSecondary.value = secondary;
  upAdd.disabled = !upName.value.trim() || !primary || !secondary;
});
function maybeEnableAdd(){
  const hexOk = h => /^#?[0-9a-f]{6}$/i.test(h.trim());
  upAdd.disabled = !(upName.value.trim() && hexOk(upPrimary.value) && hexOk(upSecondary.value));
}
upName.addEventListener('input', maybeEnableAdd);
upPrimary.addEventListener('input', maybeEnableAdd);
upSecondary.addEventListener('input', maybeEnableAdd);
function normalizeHex(h){ h=h.trim(); if(!h.startsWith('#')) h='#'+h; return h.toUpperCase(); }
upAdd.addEventListener('click', ()=>{
  const name = upName.value.trim();
  if(!name){ alert('Enter a name.'); return; }
  const p = normalizeHex(upPrimary.value);
  const s = normalizeHex(upSecondary.value);
  const logoPath = loadedSource || upUrl.value.trim() || '';

  COLORS.push({ name, primaryHex: p, secondaryHex: s });
  LOGOS.push({ name, logo: logoPath });
  logoBy.set(name, logoPath);
  colorBy.set(name, {p, s});

  // Allow detection by literal brand name too
  if(!ALIASES[name]) ALIASES[name] = [name.toLowerCase()];

  addedBox.style.display='block';
  const line = document.createElement('div');
  line.innerHTML = `<span class="tiny">Added:</span> <strong>${name}</strong> &nbsp;|&nbsp; <span class="tiny">Logo:</span> <span style="opacity:.9">${logoPath || '—'}</span> &nbsp;|&nbsp; <span class="tiny">Primary:</span> <code>${p}</code> &nbsp; <span class="tiny">Secondary:</span> <code>${s}</code>`;
  addedBox.appendChild(line);

  renderGrid();
  upName.value = ''; upAdd.disabled = true;
});

/* ===========================
   Tabs (mobile friendly)
   =========================== */
const tabName = $('tab-name');
const tabIsin = $('tab-isin');
const panelName = $('panel-name');
const panelIsin = $('panel-isin');

function activate(tab){
  const byId = id=>document.getElementById(id);
  if(tab==='name'){
    tabName.classList.add('active'); tabName.setAttribute('aria-selected','true');
    tabIsin.classList.remove('active'); tabIsin.setAttribute('aria-selected','false');
    panelName.hidden = false; panelIsin.hidden = true;
    $('fund').focus();
    kvEl.style.display='grid'; // still show KV (Fund Name row will fill)
  }else{
    tabIsin.classList.add('active'); tabIsin.setAttribute('aria-selected','true');
    tabName.classList.remove('active'); tabName.setAttribute('aria-selected','false');
    panelIsin.hidden = false; panelName.hidden = true;
    $('isin').focus();
    kvEl.style.display='grid';
  }
  clearMsg();
}
tabName.addEventListener('click', ()=>activate('name'));
tabIsin.addEventListener('click', ()=>activate('isin'));

/* Copy buttons initial handlers */
pcopy.onclick = scopy.onclick = ()=>{};

/* Init */
activate('name');
</script>
</body>
</html>